{{ config(materialized="table", database="RBOK_RPT", schema="ECOM_ANALYTICS") }}

Select * from (
SELECT
'RETAIL_SALES' as SOURCE,
CONCAT(DATEDIFF(day, '1900-01-01'::TIMESTAMP, TRANSACTION_DATE)+1,'|',BRAND_LOCATION_ID) as SAP_DATE_LOCATION_KEY,
CONCAT(ACCTGPRDMNTHNUM,'|',KEY_CATEGORY_DESC) as GA_STYLE_MONTH_KEY,
TRANSACTION_DATE,
DIVISION_NAME,
STYLE_NAME,
BUSINESS_SEGMENT_DESC,
KEY_CATEGORY_DESC,
ARTICLE,
CALDT,
ACCTGPRDQTRNUM,
ACCTGPRDQTRLNGNM,
ACCTGPRDYRNM,
ACCTGPRDYR,
ACCTGPRDQTRNM,
ACCTGPRDMNTHNM,
ACCTGPRDWOYNM,
ACCTGPRDWOYNM_NUMBER,
SEASNNM,
ACCTGPRDYRWKNUM,
ACCTGPRDMNTHNUM,
ORIGINAL_TRANSACTION_ID,
UNITS_SOLD,
GROSS_SALES_USD,
COST_USD,
MARGIN_SALES,
DISCOUNTED_FLAG,
PROMO_MARKDOWN_USD,
TOTAL_MARKDOWNS_USD,
DISCOUNT_USD,
NUMBER_OF_ORDERS,
TRANSACTION_TYPE_CODE,
ITEM_SEASON_NAME,
PRODUCT_GROUP,
ARTICLE_CREATION_SEASON,
ARTICLE_ACTIVE_SEASON,
VENDOR_ID,
FORECAST_IND,
ORIGINAL_RETAIL,
SPARC_LOCATION_ID,
BRAND_LOCATION_ID,
LOCATION_NAME,
SUB_CHANNEL_ID,
SUB_CHANNEL,
CHANNEL_ID,
CHANNEL,
CITY,
STATE,
POSTAL_CODE,
COUNTRY,
LATITUDE,
LONGITUDE,
SELLING_CHANNEL_ID,
ORDER_TYPE_ID,
NULL AS USER_SESSION_KEY,
NULL AS MAX_CHECKOUT_STAGE,
NULL AS ECOMMERCE_TRANSACTION_ID,
NULL AS DEVICE_CATEGORY,
NULL AS UNITS_ORDERED,
NULL AS FRANCHISE,
NULL AS GENDER,
NULL AS CORPORATE_MARKETING_LINE,
NULL AS PRODUCT_TYPE,
NULL AS CATEGORY_MARKETING_LINE,
NULL AS ITEMS_ITEM_REVENUE_IN_USD,
NULL AS LASTTOUCH_TRAFFIC_CAMPAIGN,
NULL AS LASTTOUCH_TRAFFIC_MEDIUM,
NULL AS LASTTOUCH_TRAFFIC_SOURCE
from "RBOK_RPT"."ECOM_ANALYTICS"."RETAIL_SALES_AGGREGATED"
)

UNION


Select * from(
SELECT
'GA4' as SOURCE,
NULL as SAP_DATE_LOCATION_KEY,
CONCAT(ACCTGPRDMNTHNUM,'|',KEY_CATEGORY_DESC) as GA_STYLE_MONTH_KEY,
EVENT_DATE as TRANSACTION_DATE,
DIVISION_NAME,
STYLE as STYLE_NAME,
BUSINESS_SEGMENT_DESC,
KEY_CATEGORY_DESC,
ARTICLE,
CALDT,
ACCTGPRDQTRNUM,
ACCTGPRDQTRLNGNM,
ACCTGPRDYRNM,
ACCTGPRDYR,
ACCTGPRDQTRNM,
ACCTGPRDMNTHNM,
ACCTGPRDWOYNM,
ACCTGPRDWOYNM_NUMBER,
SEASNNM,
ACCTGPRDYRWKNUM,
ACCTGPRDMNTHNUM,
NULL AS ORIGINAL_TRANSACTION_ID,
NULL AS UNITS_SOLD,
NULL AS GROSS_SALES_USD,
NULL AS COST_USD,
NULL AS MARGIN_SALES,
NULL AS DISCOUNTED_FLAG,
NULL AS PROMO_MARKDOWN_USD,
NULL AS TOTAL_MARKDOWNS_USD,
NULL AS DISCOUNT_USD,
NULL AS NUMBER_OF_ORDERS,
NULL AS TRANSACTION_TYPE_CODE,
NULL AS ITEM_SEASON_NAME,
NULL AS PRODUCT_GROUP,
NULL AS ARTICLE_CREATION_SEASON,
NULL AS ARTICLE_ACTIVE_SEASON,
NULL AS VENDOR_ID,
NULL AS FORECAST_IND,
NULL AS ORIGINAL_RETAIL,
NULL AS SPARC_LOCATION_ID,
NULL AS BRAND_LOCATION_ID,
NULL AS LOCATION_NAME,
NULL AS SUB_CHANNEL_ID,
NULL AS SUB_CHANNEL,
NULL AS CHANNEL_ID,
NULL AS CHANNEL,
NULL AS CITY,
NULL AS STATE,
NULL AS POSTAL_CODE,
NULL AS COUNTRY,
NULL AS LATITUDE,
NULL AS LONGITUDE,
NULL AS SELLING_CHANNEL_ID,
NULL AS ORDER_TYPE_ID,
USER_SESSION_KEY,
MAX_CHECKOUT_STAGE,
ECOMMERCE_TRANSACTION_ID,
DEVICE_CATEGORY,
UNITS_ORDERED,
FRANCHISE,
GENDER,
CORPORATE_MARKETING_LINE,
PRODUCT_TYPE,
CATEGORY_MARKETING_LINE,
ITEMS_ITEM_REVENUE_IN_USD,
LASTTOUCH_TRAFFIC_CAMPAIGN,
LASTTOUCH_TRAFFIC_MEDIUM,
LASTTOUCH_TRAFFIC_SOURCE
from "RBOK_RPT"."ECOM_ANALYTICS"."GA4_AGGREGATED"
)

