{{ config(materialized="table", database="RBOK_RPT", schema="ECOM_ANALYTICS") }}

Select
EVENT_DATE,
USER_SESSION_KEY,
MAX_CHECKOUT_STAGE,
ECOMMERCE_TRANSACTION_ID,
DEVICE_CATEGORY,
sum(UNITS_ORDERED) as UNITS_ORDERED,
CAMPAIGN,
MEDIUM,
SOURCE,
ITEMS_ITEM_ID,
STYLE,
FRANCHISE,
GENDER,
CORPORATE_MARKETING_LINE,
PRODUCT_TYPE,
CATEGORY_MARKETING_LINE,
sum(ITEMS_QUANTITY) as ITEMS_QUANTITY,
sum(ITEMS_ITEM_REVENUE_IN_USD) as ITEMS_ITEM_REVENUE_IN_USD,
--EP_PAGE_TYPE,
--EP_PAGE_OWNER,
LASTTOUCH_TRAFFIC_NAME,
LASTTOUCH_TRAFFIC_MEDIUM,
LASTTOUCH_TRAFFIC_SOURCE,
DIVISION_NAME,
KEY_CATEGORY_DESC,
BUSINESS_SEGMENT_DESC,
CALDT,
ACCTGPRDQTRNUM,
ACCTGPRDQTRLNGNM,
ACCTGPRDYRNM,
ACCTGPRDYR,
ACCTGPRDQTRNM,
ACCTGPRDMNTHNM,
ACCTGPRDWOYNM,
ACCTGPRDWOYNM_NUMBER,
SEASNNM
from "SPARC_BASE"."ECOM_ANALYTICS"."GA4_SNAPSHOT_V6"
GROUP BY
EVENT_DATE,
USER_SESSION_KEY,
MAX_CHECKOUT_STAGE,
ECOMMERCE_TRANSACTION_ID,
DEVICE_CATEGORY,
CAMPAIGN,
MEDIUM,
SOURCE,
ITEMS_ITEM_ID,
STYLE,
FRANCHISE,
GENDER,
CORPORATE_MARKETING_LINE,
PRODUCT_TYPE,
CATEGORY_MARKETING_LINE,
--EP_PAGE_TYPE,
--EP_PAGE_OWNER,
LASTTOUCH_TRAFFIC_NAME,
LASTTOUCH_TRAFFIC_MEDIUM,
LASTTOUCH_TRAFFIC_SOURCE,
DIVISION_NAME,
KEY_CATEGORY_DESC,
BUSINESS_SEGMENT_DESC,
CALDT,
ACCTGPRDQTRNUM,
ACCTGPRDQTRLNGNM,
ACCTGPRDYRNM,
ACCTGPRDYR,
ACCTGPRDQTRNM,
ACCTGPRDMNTHNM,
ACCTGPRDWOYNM,
ACCTGPRDWOYNM_NUMBER,
SEASNNM
ORDER BY EVENT_DATE, USER_SESSION_KEY DESC